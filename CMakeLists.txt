cmake_minimum_required(VERSION 3.0)

project(pybinding)
add_definitions("-std=c++11")

# Python 3.x is required, 3.4 recommended
set(PYTHON_VERSION 3)
add_subdirectory(dependencies/boost_python)

set(CMAKE_MODULE_PATH ${PROJECT_SOURCE_DIR}/cmake ${CMAKE_MODULE_PATH})
find_package(NumPy REQUIRED)
find_package(Eigen3orDownload 3.2.4 REQUIRED)

if(NOT CMAKE_BUILD_TYPE)
    set(CMAKE_BUILD_TYPE "Release" CACHE STRING "Choose the type of build" FORCE)
endif()

include_directories(
    include
    ${EIGEN3_INCLUDE_DIR}
    ${PYTHON_INCLUDE_DIR}
    ${NUMPY_INCLUDE_DIRS}
)

file(GLOB_RECURSE srcs FOLLOW_SYMLINKS include/* src/*)

set(CMAKE_LIBRARY_OUTPUT_DIRECTORY ${CMAKE_HOME_DIRECTORY})
boost_python_add_module(_pybinding ${srcs})

# compiler specific config
if(${CMAKE_CXX_COMPILER_ID} STREQUAL Clang)
elseif(${CMAKE_CXX_COMPILER_ID} STREQUAL GNU)
elseif(${CMAKE_CXX_COMPILER_ID} STREQUAL Intel)
    add_definitions("-xHost")
    find_package(MKL REQUIRED)
    if(MKL_INCLUDE_DIR)
        add_definitions(-mkl=parallel -DTBM_USE_MKL)
        set(CMAKE_MODULE_LINKER_FLAGS "-mkl=parallel")
    endif()
    # disable a warning generated by the Eigen3 library
    add_definitions(-diag-disable 1478)
elseif (${CMAKE_CXX_COMPILER_ID} STREQUAL MSVC)
endif()
