version: '{build}'
os: Visual Studio 2015
platform:
- x86
- x64
environment:
  PB_WERROR: ON
  PB_TESTS: ON
  PB_NATIVE_SIMD: OFF
  PYPI_USER:
    secure: VNmO0xqOUrgWa0uT/HO/mg==
  PYPI_PASS:
    secure: gqNQRQIXkXmSul5JkOKj4owHUprr3Q4gJ6U6Mtlgm4M=
  matrix:
  - CONDA: 35
install:
- git submodule update -q --init --recursive
- ps: |
    if ($env:PLATFORM -eq "x64") { $env:CONDA = "$env:CONDA-x64" }
    $env:PATH = "C:\Miniconda$env:CONDA\;C:\Miniconda$env:CONDA\Scripts\;$env:PATH"
    conda update -y -q conda
    conda install -y -q numpy scipy matplotlib
build_script:
- python setup.py build_ext
- python setup.py install > nul
- python -m pybinding.utils.cpuinfo
test_script:
- .\build\cmake\cppcore\tests\Release\catch
- py.test
deploy_script:
- ps: |
    pip install -U -q wheel
    pip install -q twine
    if ($env:APPVEYOR_REPO_TAG -eq "true") {
      python setup.py bdist_wheel > $null
      twine upload -u $env:PYPI_USER -p $env:PYPI_PASS --skip-existing dist\*.whl
    }
